<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=0.5">

        <link href="/css/main.css" rel="stylesheet" type="text/css">
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">
        <link rel="shortcut icon" href="/image/Yc.jpg">
        <link href="/css/prism.css" rel="stylesheet" />
        <title>some tips</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-78070816-3"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'UA-78070816-3');
        </script>
    </head>
    <body>
        <!-- suppport block of mathjax -->
        <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <!-- support mathjax inline -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                tex2jax: {inlineMath: [['$','$']]},
                messageStyle: "none"
            });
        </script>
        <script>
            if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)){
                document.body.classList.add('mobile');
            }
        </script>
        <script src="/js/prism.js"></script>
        <div class="inner">
            <h2>some tips</h2>

<p>这是我在学习及工作过程中遇到的一些小的点，记录下来方便以后遇到类型问题后翻阅，相当于一个速查表吧。现发表出来，若您还有其他 tips 愿意和我分享，请通过<a href="/about">关于我</a>联系我。此篇文章会不定期更新。</p>

<ul>
<li>crontab 运行记录在 <code>/var/log/cron</code> 文件里</li>
<li>监控系统状况

<ul>
<li>监控 CPU 情况：<code>sar 1</code> 表示每隔1s打印一次</li>
<li>监控内存情况：<code>sar -r 1</code></li>
<li>sar 安装:<code>yum -y install sysstat</code></li>
<li>CPU 信息：<code>cat /proc/cpuinfo</code></li>
<li>内存信息：<code>cat /proc/meminfo</code></li>
<li>CPU 占用率：<code>cat /proc/stat</code></li>
</ul></li>
<li>四个进程，每个进程 8 线程跑，OS 会按照 32 个线程调度，而不是 4 个进程调度？</li>
<li>ffmpeg 使用 map 参数时，需要对每个视频分别指定编码参数，包括编码器，否则会使用默认编码器(libx264)。</li>
<li>文件的三个时间：<code>stat file</code> 可查看

<ul>
<li>ctime:Change time，状态修改时间</li>
<li>atime:Access time，访问时间</li>
<li>mtime:Modify time，文件修改时间</li>
</ul></li>
<li>docker 使用 <code>-v</code> 参数挂载数据卷时，容器内部没有权限：

<ul>
<li><code>run</code> 时加上 <code>--privileged=true</code> 特权；</li>
<li>临时关闭 selinux <code>setenforce 0</code></li>
<li>添加 SELinux 规则： http://www.openskill.cn/article/520</li>
</ul></li>
<li>虚拟机是 CentOS7，在和外网通信时需要关闭防火墙 <code>systemctl stop firewalld</code></li>
<li>bash 运行多个命令：<code>bash -c 'cmd1 &amp;&amp; cmd2</code>，这在 docker 中很有用。</li>
<li>显示一个路径的所有权限：<code>namei -om /path/to/check</code></li>
<li><code>nslookup</code> 命令可以查看某个域名所解析的记录值</li>
<li><code>top -bn 5</code> 可以输出到文件</li>
<li>脚本为什么慢？需要生成进程。</li>
<li>进行多任务并发测试时，不能统计每个进程时间再相加，会重复统计。</li>
<li><code>ssh-copy-id -i ~/.ssh/id_rsa.pub user@host</code> 拷贝本地公钥到服务器，可免密码登录</li>
<li>alias 能否更改 cd 命令，每次 cd 后自动 ls ？待解决</li>
<li><code>.</code> 表示将另一个脚本中内容包含进来并执行</li>
<li>bash 执行 <code>set -i vi</code> 可以以 vim 方式操作命令行。</li>
<li>git status 命令对中文文件名乱码：<code>git config --global core.quotepath false</code></li>
<li><code>vim下使用</code>:%!xxd<code>将文本转换为十六进制，</code>:%!xxd -r<code>可转换回来。</code></li>
<li><code>tc</code>可用来模拟丢包；</li>
<li>vim命令行操作，类似<code>vim +PluginInstall +qall</code>
<!--  * code review 能否自动化？--></li>
<li>netstat -s<code>命令和</code>ss<code>命令可以查看网络相关情况</code></li>
<li>strace<code>可以查看进行进行的系统调用.</code></li>
<li>golang 中的<code>break label</code>和<code>continue label</code>语法可以很方便地在嵌套循环中控制外层循环。`</li>
<li>man -w <code>可以列出所有 man 手册的位置；</code></li>
<li>listen 函数中 backlog 参数指定全连接队列的长度。</li>
<li>压测时客户端可能出现大量连接处于 TIME_WAIT 状态，导致连接被用完；</li>
<li>QPS= 并发数 / 平均响应时间；</li>
<li>shell 中 esc + back 键可以快速删除当前命令行一部分；</li>
<li>数组中元素内部带有互斥锁时，不能通过<code>for _,val:=range(array){}</code>访问，因为会拷贝锁;</li>
<li><code>grep -F -f a.txt b.txt</code>可以求两个文件的交集；</li>
<li><code>sed 's/.*([0-9]*).*/\1/g' file</code> 可以提取字符串，<code>\1</code>表示用第一个括号里面的内容替换掉整个字符串。</li>
<li>服务回滚管理最佳实践，配置文件是否应该提交到内部私有代码仓库中？如提交/不提交，线上和测试环境不一致问题如何管理？</li>
<li>golang 语法糖之三个点：

<ul>
<li>用于可变参数列表，如<code>func foo(keys ...int){}</code>；</li>
<li>用于打散slice，如<code>slice=append(slice,other_slice...)</code>；</li>
<li>用于自动确定数组长度，如<code>array:=[...]int{1,2,3,4,5}</code>;</li>
<li>用于 go get 下载所有的包，如<code>go get github.com/abc/xyz/...</code></li>
</ul></li>
<li><code>w</code>命令可以用来看谁都登录了机器并且在做什么；</li>
<li>免密登录服务器步骤：

<ul>
<li>本机生成公钥/密钥：<code>ssh-keygen</code></li>
<li>本机编辑 config 文件：<code>vim ~/.ssh/config</code></li>
<li>将公钥上传到远程主机上：<code>ssh-copy-id user@host</code></li>
</ul></li>
<li>yes | yum install xxx<code>自动输入 yes;</code></li>
<li><code>一个坑：golang MySQL 包调用 rows.Scan() 前必须调用 rows.Next()，否则会失败。</code></li>
<li><code>golang 中如果不想让 struct 中某个字段序列化到 json 中，可以指定它的 field 为</code>json:&quot;-&quot;<code>。</code></li>
<li><code>接手一个项目代码时，可以先了解下其功能及大体流程，然后跟踪关键部分代码，而不必要对细枝末节过于追究，如解析配置等。</code></li>
<li><code>pwdx</code> 命令可以根据 pid 查到可执行文件具体路径。https://mp.weixin.qq.com/s/tHLJJTi5EqOEBeXL3_T0Og</li>
<li>可以调研下在 macOS 和 iOS 上都可以跑的 docker，这样就可以去掉虚拟机，直接在 docker 上运行虚拟机。镜像及相关数据通过 iCloud 备份，真正实现「云办公」。</li>
<li>vmware 开启共享文件夹后看不到/权限问题：<code>vmhgfs-fuse .host:/ /mnt/hgfs -o uid=1000 -o gid=1000 -o umask=0033</code> 或者 <code>vmhgfs-fuse -o allow_other .host:/ /mnt/hgfs</code></li>
<li>python -m SimpleHTTPServer 8899 可以直接从服务器下载文件</li>
<li>sed 处理的时候，会先去掉换行符，处理完成后再加上。因此无法直接替换掉换行符，需要使用模式空间来处理；</li>
<li>代码注释：NOTE, OPTIMIZE, TODO, HACK, XXX, FIXME, and BUG；</li>
<li>不要轻易 &quot;相信&quot; 别人。使用别人服务或接口前，要经过充分验证。</li>
</ul>

        </div>
    </body>
</html>

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/haoel/anti-baidu@0.6.2/js/anti-baidu-latest.min.js" charset="UTF-8"></script>
